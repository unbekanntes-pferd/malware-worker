import { Controller, Logger } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';
import { EventPattern } from '@nestjs/microservices';
import { EventTypeNames } from './action.models';
import { NodeWebhookDto } from './dtos/node-webhook.dto';
import { VaasService } from './vaas/vaas.service';

@Controller()
export class AppController {
  logger = new Logger('AppController');

  constructor(private readonly vaasService: VaasService, private readonly configService: ConfigService) {}

  @EventPattern({ msg: EventTypeNames.fileCreated })
  async getVerdict(nodePayload: NodeWebhookDto) {

    this.logger.log('Received file.created event.');

    await this.vaasService.getVerdict(nodePayload);

  }

}
